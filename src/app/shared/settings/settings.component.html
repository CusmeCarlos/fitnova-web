<!-- src/app/shared/settings/settings.component.html -->
<!-- ‚öôÔ∏è CONFIGURACI√ìN DEL SISTEMA ULTRA PREMIUM - NIVEL FINZENAPP -->

<div class="settings-dashboard-container">
  
  <!-- ‚úÖ HEADER ULTRA PREMIUM CON GLASSMORPHISM -->
  <div class="premium-header">
    <div class="header-content">
      <div class="header-left">
        <button mat-icon-button class="back-btn-premium" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        
        <div class="header-info">
          <h1 class="premium-title">
            <mat-icon class="title-icon">settings</mat-icon>
            Configuraci√≥n del Sistema
          </h1>
          <p class="premium-subtitle">Panel de administraci√≥n y configuraci√≥n avanzada de FitNova</p>
        </div>
      </div>
      
      <div class="header-actions">
        <button mat-stroked-button class="action-btn-premium" (click)="refreshSettings()">
          <mat-icon>refresh</mat-icon>
          <span>Actualizar</span>
        </button>
        
        <button mat-stroked-button class="action-btn-premium" (click)="exportSettings()">
          <mat-icon>file_download</mat-icon>
          <span>Exportar</span>
        </button>
        
        <button mat-stroked-button class="action-btn-premium danger" (click)="resetToDefaults()" *ngIf="isAdmin()">
          <mat-icon>restore</mat-icon>
          <span>Restaurar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ LOADING STATE PREMIUM -->
  <div class="loading-state-premium" *ngIf="isLoading">
    <div class="loading-content">
      <div class="loading-spinner">
        <mat-spinner diameter="60"></mat-spinner>
      </div>
      <h3>Cargando configuraci√≥n del sistema...</h3>
      <p>Sincronizando par√°metros desde Firebase</p>
    </div>
  </div>

  <!-- ‚úÖ CONTENIDO PRINCIPAL CON TABS PREMIUM -->
  <div class="settings-content-premium" *ngIf="!isLoading && systemSettings">
    
    <mat-tab-group class="premium-tabs" [(selectedIndex)]="selectedTabIndex" animationDuration="300ms">
      
      <!-- ü§ñ TAB: CONFIGURACI√ìN IA -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>psychology</mat-icon>
          <span>Inteligencia Artificial</span>
        </ng-template>
        
        <div class="tab-content">
          <form [formGroup]="aiForm" class="settings-form">
            
            <!-- Header de secci√≥n -->
            <div class="section-header">
              <h3>
                <mat-icon>smart_toy</mat-icon>
                Configuraci√≥n de Par√°metros IA
              </h3>
              <p>Ajusta la sensibilidad y precisi√≥n de MediaPipe y GPT-4</p>
            </div>

            <!-- MediaPipe Configuration -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>visibility</mat-icon>
                  MediaPipe Pose Detection
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Sensibilidad de Pose</mat-label>
                    <mat-slider 
                      min="0.1" 
                      max="1.0" 
                      step="0.1" 
                      discrete
                      formControlName="poseSensitivity">
                    </mat-slider>
                    <mat-hint>Valor: {{ formatPercentage(aiForm.get('poseSensitivity')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Umbral de Confianza</mat-label>
                    <mat-slider 
                      min="0.5" 
                      max="0.95" 
                      step="0.05" 
                      discrete
                      formControlName="confidenceThreshold">
                    </mat-slider>
                    <mat-hint>Valor: {{ formatPercentage(aiForm.get('confidenceThreshold')?.value) }}</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Umbral de Detecci√≥n</mat-label>
                    <mat-slider 
                      min="0.3" 
                      max="0.8" 
                      step="0.05" 
                      discrete
                      formControlName="detectionThreshold">
                    </mat-slider>
                    <mat-hint>Valor: {{ formatPercentage(aiForm.get('detectionThreshold')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>FPS M√°ximo</mat-label>
                    <input matInput type="number" formControlName="maxFramesPerSecond" min="15" max="60">
                    <mat-hint>Frames por segundo para procesamiento</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Error Classification -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>warning</mat-icon>
                  Clasificaci√≥n de Errores
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field critical">
                    <mat-label>Umbral Cr√≠tico</mat-label>
                    <mat-slider 
                      min="0.8" 
                      max="1.0" 
                      step="0.05" 
                      discrete
                      formControlName="criticalThreshold">
                    </mat-slider>
                    <mat-hint>Errores cr√≠ticos: {{ formatPercentage(aiForm.get('criticalThreshold')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field high">
                    <mat-label>Umbral Alto</mat-label>
                    <mat-slider 
                      min="0.6" 
                      max="0.8" 
                      step="0.05" 
                      discrete
                      formControlName="highThreshold">
                    </mat-slider>
                    <mat-hint>Errores altos: {{ formatPercentage(aiForm.get('highThreshold')?.value) }}</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field medium">
                    <mat-label>Umbral Medio</mat-label>
                    <mat-slider 
                      min="0.4" 
                      max="0.6" 
                      step="0.05" 
                      discrete
                      formControlName="mediumThreshold">
                    </mat-slider>
                    <mat-hint>Errores medios: {{ formatPercentage(aiForm.get('mediumThreshold')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field low">
                    <mat-label>Umbral Bajo</mat-label>
                    <mat-slider 
                      min="0.2" 
                      max="0.4" 
                      step="0.05" 
                      discrete
                      formControlName="lowThreshold">
                    </mat-slider>
                    <mat-hint>Errores bajos: {{ formatPercentage(aiForm.get('lowThreshold')?.value) }}</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- GPT Configuration -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>auto_awesome</mat-icon>
                  Configuraci√≥n GPT-4
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Creatividad GPT</mat-label>
                    <mat-slider 
                      min="0.1" 
                      max="1.0" 
                      step="0.1" 
                      discrete
                      formControlName="gptCreativity">
                    </mat-slider>
                    <mat-hint>Temperature: {{ formatPercentage(aiForm.get('gptCreativity')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Longitud de Respuesta</mat-label>
                    <input matInput type="number" formControlName="gptResponseLength" min="100" max="1000">
                    <mat-hint>Tokens m√°ximos por respuesta</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Auto-aprobaci√≥n</mat-label>
                    <mat-slider 
                      min="0.75" 
                      max="0.95" 
                      step="0.05" 
                      discrete
                      formControlName="autoApprovalThreshold">
                    </mat-slider>
                    <mat-hint>Umbral: {{ formatPercentage(aiForm.get('autoApprovalThreshold')?.value) }}</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Intervalo de Procesamiento</mat-label>
                    <input matInput type="number" formControlName="processingInterval" min="100" max="1000">
                    <mat-hint>Milisegundos entre procesamiento</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Informaci√≥n de √∫ltima actualizaci√≥n -->
            <div class="update-info" *ngIf="systemSettings">
              <mat-icon>schedule</mat-icon>
              <span>
                √öltima actualizaci√≥n: {{ formatDate(systemSettings.aiSettings.lastUpdated) }}
                por {{ systemSettings.aiSettings.updatedBy }}
              </span>
            </div>

            <!-- Bot√≥n guardar -->
            <div class="form-actions">
              <button mat-raised-button color="primary" class="save-btn" (click)="saveAISettings()" 
                      [disabled]="aiForm.invalid">
                <mat-icon>save</mat-icon>
                <span>Guardar Configuraci√≥n IA</span>
              </button>
            </div>
            
          </form>
        </div>
      </mat-tab>

      <!-- üèãÔ∏è TAB: CONFIGURACI√ìN GIMNASIO -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>fitness_center</mat-icon>
          <span>Gimnasio</span>
        </ng-template>
        
        <div class="tab-content">
          <form [formGroup]="gymForm" class="settings-form">
            
            <!-- Header de secci√≥n -->
            <div class="section-header">
              <h3>
                <mat-icon>business</mat-icon>
                Configuraci√≥n del Gimnasio GYMSHARK
              </h3>
              <p>Informaci√≥n general y par√°metros operativos del establecimiento</p>
            </div>

            <!-- Informaci√≥n General -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>info</mat-icon>
                  Informaci√≥n General
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Nombre del Gimnasio</mat-label>
                    <input matInput formControlName="name" required>
                    <mat-hint>Nombre oficial del establecimiento</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Email de Contacto</mat-label>
                    <input matInput type="email" formControlName="email" required>
                    <mat-hint>Email principal para comunicaciones</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Tel√©fono</mat-label>
                    <input matInput formControlName="phone" required>
                    <mat-hint>N√∫mero de contacto principal</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field full-width">
                    <mat-label>Direcci√≥n Completa</mat-label>
                    <textarea matInput formControlName="address" rows="2" required></textarea>
                    <mat-hint>Direcci√≥n f√≠sica del establecimiento</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Configuraci√≥n Operativa -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>schedule</mat-icon>
                  Configuraci√≥n Operativa
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Hora de Apertura</mat-label>
                    <input matInput type="time" formControlName="openTime" required>
                    <mat-hint>Horario de inicio de operaciones</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Hora de Cierre</mat-label>
                    <input matInput type="time" formControlName="closeTime" required>
                    <mat-hint>Horario de fin de operaciones</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>D√≠as de Operaci√≥n</mat-label>
                    <mat-select formControlName="operatingDays" multiple>
                      <mat-option *ngFor="let day of operatingDaysOptions" [value]="day.value">
                        {{ day.label }}
                      </mat-option>
                    </mat-select>
                    <mat-hint>Selecciona los d√≠as que opera el gimnasio</mat-hint>
                  </mat-form-field>

                  <div class="maintenance-toggle">
                    <mat-slide-toggle formControlName="maintenanceMode" color="warn">
                      <mat-icon>build</mat-icon>
                      Modo Mantenimiento
                    </mat-slide-toggle>
                    <span class="toggle-hint">Suspende operaciones temporalmente</span>
                  </div>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Capacidad y L√≠mites -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>groups</mat-icon>
                  Capacidad y L√≠mites
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>M√°ximo de Usuarios</mat-label>
                    <input matInput type="number" formControlName="maxUsers" min="1" max="100">
                    <mat-hint>Capacidad m√°xima simult√°nea</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>M√°ximo de Entrenadores</mat-label>
                    <input matInput type="number" formControlName="maxTrainers" min="1" max="20">
                    <mat-hint>Personal t√©cnico m√°ximo</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Duraci√≥n M√°xima de Sesi√≥n</mat-label>
                    <input matInput type="number" formControlName="maxSessionDuration" min="30" max="300">
                    <mat-hint>Minutos por sesi√≥n de entrenamiento</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Equipamiento Disponible -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>fitness_center</mat-icon>
                  Equipamiento Disponible
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="equipment-list">
                  <mat-chip-listbox *ngIf="systemSettings?.gymSettings?.availableEquipment">
                    <mat-chip-option 
                      *ngFor="let equipment of systemSettings.gymSettings.availableEquipment" 
                      [selectable]="false">
                      <mat-icon>check_circle</mat-icon>
                      {{ equipment }}
                    </mat-chip-option>
                  </mat-chip-listbox>
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Informaci√≥n de √∫ltima actualizaci√≥n -->
            <div class="update-info" *ngIf="systemSettings">
              <mat-icon>schedule</mat-icon>
              <span>
                √öltima actualizaci√≥n: {{ formatDate(systemSettings.gymSettings.lastUpdated) }}
                por {{ systemSettings.gymSettings.updatedBy }}
              </span>
            </div>

            <!-- Bot√≥n guardar -->
            <div class="form-actions">
              <button mat-raised-button color="primary" class="save-btn" (click)="saveGymSettings()" 
                      [disabled]="gymForm.invalid">
                <mat-icon>save</mat-icon>
                <span>Guardar Configuraci√≥n Gimnasio</span>
              </button>
            </div>
            
          </form>
        </div>
      </mat-tab>

      <!-- üîî TAB: NOTIFICACIONES -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>notifications</mat-icon>
          <span>Notificaciones</span>
        </ng-template>
        
        <div class="tab-content">
          <form [formGroup]="notificationForm" class="settings-form">
            
            <!-- Header de secci√≥n -->
            <div class="section-header">
              <h3>
                <mat-icon>campaign</mat-icon>
                Configuraci√≥n de Notificaciones
              </h3>
              <p>Gestiona alertas cr√≠ticas y reportes del sistema</p>
            </div>

            <!-- Alertas Cr√≠ticas -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>warning</mat-icon>
                  Alertas Cr√≠ticas
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="enableCriticalAlerts" color="primary">
                    <mat-icon>notifications_active</mat-icon>
                    Habilitar Alertas Cr√≠ticas
                  </mat-slide-toggle>
                  <span class="toggle-hint">Activar sistema de alertas en tiempo real</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="criticalAlertSound" color="accent">
                    <mat-icon>volume_up</mat-icon>
                    Sonido de Alerta
                  </mat-slide-toggle>
                  <span class="toggle-hint">Reproducir sonido para alertas cr√≠ticas</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="criticalAlertEmail" color="primary">
                    <mat-icon>email</mat-icon>
                    Notificaci√≥n por Email
                  </mat-slide-toggle>
                  <span class="toggle-hint">Enviar alertas cr√≠ticas por correo</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="criticalAlertSMS" color="accent">
                    <mat-icon>sms</mat-icon>
                    Notificaci√≥n por SMS
                  </mat-slide-toggle>
                  <span class="toggle-hint">Enviar alertas cr√≠ticas por mensaje de texto</span>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Notificaciones del Sistema -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>system_update</mat-icon>
                  Notificaciones del Sistema
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="enableSystemNotifications" color="primary">
                    <mat-icon>notifications</mat-icon>
                    Notificaciones del Sistema
                  </mat-slide-toggle>
                  <span class="toggle-hint">Recibir notificaciones generales del sistema</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="dailyReports" color="accent">
                    <mat-icon>today</mat-icon>
                    Reportes Diarios
                  </mat-slide-toggle>
                  <span class="toggle-hint">Resumen diario de actividad</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="weeklyReports" color="primary">
                    <mat-icon>date_range</mat-icon>
                    Reportes Semanales
                  </mat-slide-toggle>
                  <span class="toggle-hint">An√°lisis semanal de rendimiento</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="monthlyReports" color="accent">
                    <mat-icon>calendar_month</mat-icon>
                    Reportes Mensuales
                  </mat-slide-toggle>
                  <span class="toggle-hint">Informe ejecutivo mensual</span>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Informaci√≥n de √∫ltima actualizaci√≥n -->
            <div class="update-info" *ngIf="systemSettings">
              <mat-icon>schedule</mat-icon>
              <span>
                √öltima actualizaci√≥n: {{ formatDate(systemSettings.notificationSettings.lastUpdated) }}
                por {{ systemSettings.notificationSettings.updatedBy }}
              </span>
            </div>

            <!-- Bot√≥n guardar -->
            <div class="form-actions">
              <button mat-raised-button color="primary" class="save-btn" (click)="saveNotificationSettings()" 
                      [disabled]="notificationForm.invalid">
                <mat-icon>save</mat-icon>
                <span>Guardar Configuraci√≥n Notificaciones</span>
              </button>
            </div>
            
          </form>
        </div>
      </mat-tab>

      <!-- üíæ TAB: BACKUP Y DATOS -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>backup</mat-icon>
          <span>Backup & Datos</span>
        </ng-template>
        
        <div class="tab-content">
          <form [formGroup]="backupForm" class="settings-form">
            
            <!-- Header de secci√≥n -->
            <div class="section-header">
              <h3>
                <mat-icon>cloud_download</mat-icon>
                Gesti√≥n de Respaldos y Datos
              </h3>
              <p>Configuraci√≥n de backup autom√°tico y gesti√≥n de datos del sistema</p>
            </div>

            <!-- Configuraci√≥n Autom√°tica -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>schedule</mat-icon>
                  Backup Autom√°tico
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="enableAutoBackup" color="primary">
                    <mat-icon>autorenew</mat-icon>
                    Habilitar Backup Autom√°tico
                  </mat-slide-toggle>
                  <span class="toggle-hint">Crear respaldos programados autom√°ticamente</span>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Frecuencia de Backup</mat-label>
                    <mat-select formControlName="backupFrequency">
                      <mat-option *ngFor="let freq of backupFrequencyOptions" [value]="freq.value">
                        <mat-icon>schedule</mat-icon>
                        {{ freq.label }}
                      </mat-option>
                    </mat-select>
                    <mat-hint>Con qu√© frecuencia crear respaldos</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Hora de Backup</mat-label>
                    <input matInput type="time" formControlName="backupTime">
                    <mat-hint>Hora para ejecutar backup autom√°tico</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>D√≠as de Retenci√≥n</mat-label>
                    <input matInput type="number" formControlName="retentionDays" min="7" max="365">
                    <mat-hint>D√≠as para mantener respaldos antiguos</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Ubicaci√≥n de Backup</mat-label>
                    <mat-select formControlName="backupLocation">
                      <mat-option *ngFor="let location of backupLocationOptions" [value]="location.value">
                        <mat-icon>cloud</mat-icon>
                        {{ location.label }}
                      </mat-option>
                    </mat-select>
                    <mat-hint>D√≥nde almacenar los respaldos</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Contenido del Backup -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>folder</mat-icon>
                  Contenido del Backup
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="includeUserData" color="primary">
                    <mat-icon>people</mat-icon>
                    Datos de Usuarios
                  </mat-slide-toggle>
                  <span class="toggle-hint">Incluir perfiles y datos de usuarios</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="includeAlerts" color="accent">
                    <mat-icon>warning</mat-icon>
                    Alertas y Errores
                  </mat-slide-toggle>
                  <span class="toggle-hint">Incluir historial de alertas cr√≠ticas</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="includeRoutines" color="primary">
                    <mat-icon>fitness_center</mat-icon>
                    Rutinas de Entrenamiento
                  </mat-slide-toggle>
                  <span class="toggle-hint">Incluir rutinas generadas por IA</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="includeSettings" color="accent">
                    <mat-icon>settings</mat-icon>
                    Configuraci√≥n del Sistema
                  </mat-slide-toggle>
                  <span class="toggle-hint">Incluir toda la configuraci√≥n actual</span>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Tama√±o M√°ximo (MB)</mat-label>
                    <input matInput type="number" formControlName="maxBackupSize" min="100" max="2000">
                    <mat-hint>L√≠mite de tama√±o por archivo de backup</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Estado del √öltimo Backup -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>info</mat-icon>
                  Estado del Backup
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="backup-status" *ngIf="systemSettings">
                  <div class="status-item">
                    <mat-icon [style.color]="getBackupStatusColor() === 'primary' ? '#3b82f6' : getBackupStatusColor() === 'warn' ? '#f59e0b' : '#ef4444'">
                      {{ getBackupStatusColor() === 'primary' ? 'check_circle' : 'warning' }}
                    </mat-icon>
                    <span>
                      <strong>√öltimo Backup:</strong> 
                      {{ formatDate(systemSettings.backupSettings.lastBackup) }}
                    </span>
                  </div>

                  <div class="backup-actions">
                    <button mat-raised-button color="accent" class="backup-btn" (click)="createManualBackup()">
                      <mat-icon>backup</mat-icon>
                      <span>Crear Backup Manual</span>
                    </button>
                  </div>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Informaci√≥n de √∫ltima actualizaci√≥n -->
            <div class="update-info" *ngIf="systemSettings">
              <mat-icon>schedule</mat-icon>
              <span>
                √öltima actualizaci√≥n: {{ formatDate(systemSettings.backupSettings.lastUpdated) }}
                por {{ systemSettings.backupSettings.updatedBy }}
              </span>
            </div>

            <!-- Bot√≥n guardar -->
            <div class="form-actions">
              <button mat-raised-button color="primary" class="save-btn" (click)="saveBackupSettings()" 
                      [disabled]="backupForm.invalid">
                <mat-icon>save</mat-icon>
                <span>Guardar Configuraci√≥n Backup</span>
              </button>
            </div>
            
          </form>
        </div>
      </mat-tab>

      <!-- üîí TAB: SEGURIDAD -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>security</mat-icon>
          <span>Seguridad</span>
        </ng-template>
        
        <div class="tab-content">
          <form [formGroup]="securityForm" class="settings-form">
            
            <!-- Header de secci√≥n -->
            <div class="section-header">
              <h3>
                <mat-icon>shield</mat-icon>
                Configuraci√≥n de Seguridad
              </h3>
              <p>Gesti√≥n de sesiones, contrase√±as y auditor√≠a del sistema</p>
            </div>

            <!-- Configuraci√≥n de Sesiones -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>login</mat-icon>
                  Gesti√≥n de Sesiones
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Tiempo de Sesi√≥n (min)</mat-label>
                    <input matInput type="number" formControlName="sessionTimeout" min="15" max="480">
                    <mat-hint>Minutos antes de cerrar sesi√≥n autom√°ticamente</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Intentos de Login</mat-label>
                    <input matInput type="number" formControlName="maxLoginAttempts" min="2" max="10">
                    <mat-hint>M√°ximo de intentos fallidos antes de bloqueo</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Duraci√≥n de Bloqueo (min)</mat-label>
                    <input matInput type="number" formControlName="lockoutDuration" min="5" max="60">
                    <mat-hint>Minutos de bloqueo tras intentos fallidos</mat-hint>
                  </mat-form-field>

                  <div class="toggle-group">
                    <mat-slide-toggle formControlName="allowMultipleSessions" color="primary">
                      <mat-icon>devices</mat-icon>
                      Sesiones M√∫ltiples
                    </mat-slide-toggle>
                    <span class="toggle-hint">Permitir login desde varios dispositivos</span>
                  </div>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Pol√≠ticas de Contrase√±as -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>password</mat-icon>
                  Pol√≠ticas de Contrase√±as
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="requirePasswordChange" color="primary">
                    <mat-icon>update</mat-icon>
                    Cambio Obligatorio
                  </mat-slide-toggle>
                  <span class="toggle-hint">Requerir cambio peri√≥dico de contrase√±a</span>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>D√≠as de Expiraci√≥n</mat-label>
                    <input matInput type="number" formControlName="passwordExpiryDays" min="30" max="365">
                    <mat-hint>D√≠as antes de expirar contrase√±a</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Longitud M√≠nima</mat-label>
                    <input matInput type="number" formControlName="minPasswordLength" min="6" max="32">
                    <mat-hint>Caracteres m√≠nimos requeridos</mat-hint>
                  </mat-form-field>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="requireSpecialChars" color="accent">
                    <mat-icon>text_fields</mat-icon>
                    Caracteres Especiales
                  </mat-slide-toggle>
                  <span class="toggle-hint">Requerir s√≠mbolos especiales en contrase√±a</span>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Autenticaci√≥n y Auditor√≠a -->
            <mat-card class="config-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>verified_user</mat-icon>
                  Autenticaci√≥n y Auditor√≠a
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                
                <div class="toggle-row">
                  <mat-slide-toggle formControlName="enableTwoFactor" color="primary">
                    <mat-icon>security</mat-icon>
                    Autenticaci√≥n de Doble Factor
                  </mat-slide-toggle>
                  <span class="toggle-hint">Requerir verificaci√≥n adicional en login</span>
                </div>

                <div class="toggle-row">
                  <mat-slide-toggle formControlName="enableAuditLog" color="accent">
                    <mat-icon>history</mat-icon>
                    Registro de Auditor√≠a
                  </mat-slide-toggle>
                  <span class="toggle-hint">Registrar todas las acciones del sistema</span>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Retenci√≥n de Auditor√≠a (d√≠as)</mat-label>
                    <input matInput type="number" formControlName="auditRetentionDays" min="30" max="365">
                    <mat-hint>D√≠as para conservar logs de auditor√≠a</mat-hint>
                  </mat-form-field>
                </div>
                
              </mat-card-content>
            </mat-card>

            <!-- Informaci√≥n de √∫ltima actualizaci√≥n -->
            <div class="update-info" *ngIf="systemSettings">
              <mat-icon>schedule</mat-icon>
              <span>
                √öltima actualizaci√≥n: {{ formatDate(systemSettings.securitySettings.lastUpdated) }}
                por {{ systemSettings.securitySettings.updatedBy }}
              </span>
            </div>

            <!-- Bot√≥n guardar -->
            <div class="form-actions">
              <button mat-raised-button color="primary" class="save-btn" (click)="saveSecuritySettings()" 
                      [disabled]="securityForm.invalid">
                <mat-icon>save</mat-icon>
                <span>Guardar Configuraci√≥n Seguridad</span>
              </button>
            </div>
            
          </form>
        </div>
      </mat-tab>

    </mat-tab-group>

  </div>

  <!-- ‚úÖ EMPTY STATE PREMIUM -->
  <div class="empty-state-premium" *ngIf="!systemSettings && !isLoading">
    <div class="empty-content">
      <mat-icon class="empty-icon">settings</mat-icon>
      <h3>Sin configuraci√≥n disponible</h3>
      <p>No se pudo cargar la configuraci√≥n del sistema.</p>
      <button mat-raised-button color="primary" (click)="refreshSettings()">
        <mat-icon>refresh</mat-icon>
        Intentar de nuevo
      </button>
    </div>
  </div>

</div>