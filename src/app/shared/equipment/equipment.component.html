<!-- src/app/shared/equipment/equipment.component.html -->
<!-- üèãÔ∏è GESTI√ìN DE EQUIPAMIENTO ULTRA PREMIUM -->

<div class="equipment-container">
  
    <!-- HEADER PREMIUM -->
    <div class="premium-header">
      <div class="header-content">
        <div class="header-left">
          <button mat-icon-button class="back-btn-premium" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
          </button>
          
          <div class="header-info">
            <h1 class="premium-title">
              <mat-icon class="title-icon">fitness_center</mat-icon>
              Gesti√≥n de Equipamiento
            </h1>
            <p class="premium-subtitle">Control y administraci√≥n del equipamiento del gimnasio</p>
          </div>
        </div>
        
        <div class="header-actions">
          <button mat-raised-button class="action-btn-premium" (click)="showAddForm = true">
            <mat-icon>add</mat-icon>
            <span>Nuevo Equipo</span>
          </button>
        
        </div>
      </div>
    </div>
  
    <!-- LOADING STATE -->
    <div class="loading-state-premium" *ngIf="isLoading">
      <div class="loading-content">
        <div class="loading-spinner">
          <mat-spinner diameter="60"></mat-spinner>
        </div>
        <h3>Cargando equipamiento...</h3>
        <p>Sincronizando datos desde Firebase</p>
      </div>
    </div>
  
    <!-- CONTENIDO PRINCIPAL -->
    <div class="equipment-content" *ngIf="!isLoading">
  
      <!-- ESTAD√çSTICAS CARDS -->
      <div class="stats-grid" *ngIf="equipmentStats">
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
              <mat-icon>inventory_2</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ equipmentStats.total }}</h3>
              <p>Total Equipos</p>
            </div>
          </mat-card-content>
        </mat-card>
  
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
              <mat-icon>check_circle</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ equipmentStats.byStatus.operational }}</h3>
              <p>Operacionales</p>
            </div>
          </mat-card-content>
        </mat-card>
  
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
              <mat-icon>build</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ equipmentStats.byStatus.maintenance }}</h3>
              <p>En Mantenimiento</p>
            </div>
          </mat-card-content>
        </mat-card>
  
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
              <mat-icon>warning</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ equipmentStats.needsMaintenance }}</h3>
              <p>Requieren Mantenimiento</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
  
      <!-- FORMULARIO AGREGAR/EDITAR -->
      <mat-card class="form-card" *ngIf="showAddForm">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>{{ editingEquipment ? 'edit' : 'add_circle' }}</mat-icon>
            {{ editingEquipment ? 'Editar Equipo' : 'Agregar Nuevo Equipo' }}
          </mat-card-title>
        </mat-card-header>
  
        <mat-card-content>
          <form [formGroup]="equipmentForm" (ngSubmit)="onSubmit()">
            
            <!-- CAT√ÅLOGO PREDEFINIDO -->
            <div class="catalog-section" *ngIf="!editingEquipment">
              <button mat-stroked-button type="button" 
                      class="catalog-toggle-btn" 
                      (click)="toggleCatalog()">
                <mat-icon>{{ showCatalog ? 'close' : 'library_books' }}</mat-icon>
                {{ showCatalog ? 'Cerrar Cat√°logo' : 'Seleccionar desde Cat√°logo' }}
              </button>
  
              <!-- CAT√ÅLOGO ORGANIZADO POR CATEGOR√çAS Y SUBCATEGOR√çAS -->
              <div class="catalog-accordion" *ngIf="showCatalog">
                <mat-accordion multi>
                  
                  <!-- ========== PESO LIBRE ========== -->
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>fitness_center</mat-icon>
                        <strong>Peso libre</strong>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
  
                    <!-- Subcategor√≠as de Peso Libre -->
                    <mat-accordion>
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>fitness_center</mat-icon>
                            Mancuernas
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Mancuernas')"
                                  (click)="selectFromCatalog(item, 'free-weights')">
                            <span>{{ item.name }}</span>
                            <small *ngIf="item.weightRange">{{ item.weightRange }}</small>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>sports_mma</mat-icon>
                            Barras
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Barra')"
                                  (click)="selectFromCatalog(item, 'free-weights')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>album</mat-icon>
                            Discos
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Discos')"
                                  (click)="selectFromCatalog(item, 'free-weights')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>sports_kabaddi</mat-icon>
                            Kettlebells
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Kettlebell')"
                                  (click)="selectFromCatalog(item, 'free-weights')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>event_seat</mat-icon>
                            Bancos y Racks
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Banco|Rack|Soporte|√Årbol')"
                                  (click)="selectFromCatalog(item, 'free-weights')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </mat-expansion-panel>
  
                  <!-- ========== M√ÅQUINAS ========== -->
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>settings_input_composite</mat-icon>
                        <strong>Maquinas</strong>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
  
                    <mat-accordion>
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>airline_seat_recline_extra</mat-icon>
                            Pecho
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Pecho|Peck|Contractora|Cruces')"
                                  (click)="selectFromCatalog(item, 'machines')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>accessibility_new</mat-icon>
                            Espalda
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Jal√≥n|Remo|Pullover|Dominadas|Hiperextensi√≥n')"
                                  (click)="selectFromCatalog(item, 'machines')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>directions_walk</mat-icon>
                            Piernas
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Sentadilla|Leg Press|Extensi√≥n|Curl Femoral|Abductores|Aductores|Gemelos|Gl√∫teos|Sissy|Hack')"
                                  (click)="selectFromCatalog(item, 'machines')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>front_hand</mat-icon>
                            Hombros y Brazos
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Hombros|Elevaciones|Militar|Curl|Tr√≠ceps|B√≠ceps|Fondos')"
                                  (click)="selectFromCatalog(item, 'machines')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>sports_martial_arts</mat-icon>
                            Core y Multiestaciones
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Abdominales|Rotador|Flexi√≥n|Multi|Torre|Estaci√≥n')"
                                  (click)="selectFromCatalog(item, 'machines')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </mat-expansion-panel>
  
                  <!-- ========== CARDIO ========== -->
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>directions_run</mat-icon>
                        <strong>Cardio</strong>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
  
                    <mat-accordion>
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>directions_run</mat-icon>
                            Caminadoras
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'Caminadora')"
                                  (click)="selectFromCatalog(item, 'cardio')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>directions_bike</mat-icon>
                            Bicicletas
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'Bicicleta')"
                                  (click)="selectFromCatalog(item, 'cardio')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>pool</mat-icon>
                            El√≠pticas y Otros
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'El√≠ptica|Escaladora|Remo|Ski|Escalador|Fan')"
                                  (click)="selectFromCatalog(item, 'cardio')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </mat-expansion-panel>
  
                  <!-- ========== FUNCIONAL ========== -->
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>self_improvement</mat-icon>
                        <strong>Funcional</strong>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
  
                    <mat-accordion>
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>self_improvement</mat-icon>
                            TRX y Bandas
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('functional', 'TRX|Banda|Anillas|Colchoneta|Esterilla')"
                                  (click)="selectFromCatalog(item, 'functional')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>sports</mat-icon>
                            Balones y Cajas
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('functional', 'Bal√≥n|Ball|Caja|Bosu')"
                                  (click)="selectFromCatalog(item, 'functional')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
  
                      <mat-expansion-panel>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-icon>fitness_center</mat-icon>
                            Cuerdas y Accesorios
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="catalog-items-grid">
                          <button mat-stroked-button type="button" class="catalog-item"
                                  *ngFor="let item of getCatalogItemsBySubcategory('functional', 'Cuerda|Battle|Foam|Rueda|Disco|Tabla|Pelota|Sandbag|Bulgarian|Paralelas|Landmine|Barra de Dominadas')"
                                  (click)="selectFromCatalog(item, 'functional')">
                            <span>{{ item.name }}</span>
                          </button>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </mat-expansion-panel>
                  
                  <!-- PESO LIBRE -->
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'free-weights'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>fitness_center</mat-icon>
                        Mancuernas
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Mancuernas')"
                              (click)="selectFromCatalog(item, 'free-weights')">
                        <span>{{ item.name }}</span>
                        <small *ngIf="item.weightRange">{{ item.weightRange }}</small>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'free-weights'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>sports_mma</mat-icon>
                        Barras
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Barra')"
                              (click)="selectFromCatalog(item, 'free-weights')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'free-weights'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>album</mat-icon>
                        Discos
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Discos')"
                              (click)="selectFromCatalog(item, 'free-weights')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'free-weights'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>sports_kabaddi</mat-icon>
                        Kettlebells
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Kettlebell')"
                              (click)="selectFromCatalog(item, 'free-weights')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'free-weights'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>event_seat</mat-icon>
                        Bancos y Racks
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('free-weights', 'Banco|Rack|Soporte|√Årbol')"
                              (click)="selectFromCatalog(item, 'free-weights')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <!-- M√ÅQUINAS -->
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'machines'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>airline_seat_recline_extra</mat-icon>
                        Pecho
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Pecho|Peck|Contractora|Cruces')"
                              (click)="selectFromCatalog(item, 'machines')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'machines'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>accessibility_new</mat-icon>
                        Espalda
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Jal√≥n|Remo|Pullover|Dominadas|Hiperextensi√≥n')"
                              (click)="selectFromCatalog(item, 'machines')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'machines'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>directions_walk</mat-icon>
                        Piernas
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Sentadilla|Leg Press|Extensi√≥n|Curl Femoral|Abductores|Aductores|Gemelos|Gl√∫teos|Sissy|Hack')"
                              (click)="selectFromCatalog(item, 'machines')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'machines'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>front_hand</mat-icon>
                        Hombros y Brazos
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Hombros|Elevaciones|Militar|Curl|Tr√≠ceps|B√≠ceps|Fondos')"
                              (click)="selectFromCatalog(item, 'machines')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'machines'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>sports_martial_arts</mat-icon>
                        Core y Multiestaciones
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('machines', 'Abdominales|Rotador|Flexi√≥n|Multi|Torre|Estaci√≥n')"
                              (click)="selectFromCatalog(item, 'machines')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <!-- CARDIO -->
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'cardio'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>directions_run</mat-icon>
                        Caminadoras
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'Caminadora')"
                              (click)="selectFromCatalog(item,'cardio')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'cardio'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>directions_bike</mat-icon>
                        Bicicletas
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'Bicicleta')"
                              (click)="selectFromCatalog(item, 'cardio')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'cardio'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>pool</mat-icon>
                        El√≠pticas y Otros
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('cardio', 'El√≠ptica|Escaladora|Remo|Ski|Escalador|Fan')"
                              (click)="selectFromCatalog(item,'cardio')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <!-- FUNCIONAL -->
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'functional'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>self_improvement</mat-icon>
                        TRX y Bandas
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('functional', 'TRX|Banda|Anillas')"
                              (click)="selectFromCatalog(item,'functional')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'functional'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>sports</mat-icon>
                        Balones y Cajas
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('functional', 'Bal√≥n|Ball|Caja|Bosu')"
                              (click)="selectFromCatalog(item, 'functional')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                  <mat-expansion-panel *ngIf="equipmentForm.get('category')?.value === 'functional'">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>fitness_center</mat-icon>
                        Cuerdas y Accesorios
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="catalog-items-grid">
                      <button mat-stroked-button type="button" class="catalog-item"
                              *ngFor="let item of getCatalogItemsBySubcategory('functional', 'Cuerda|Battle|Colchoneta|Esterilla|Foam|Rueda|Disco|Tabla|Pelota|Sandbag|Bulgarian')"
                              (click)="selectFromCatalog(item,'functional')">
                        <span>{{ item.name }}</span>
                      </button>
                    </div>
                  </mat-expansion-panel>
  
                </mat-accordion>
              </div>
            </div>
  
            <mat-divider *ngIf="!editingEquipment && showCatalog"></mat-divider>
  
            <!-- INFORMACI√ìN B√ÅSICA -->
            <div class="form-section">
              <h3 class="section-title">
                <mat-icon>info</mat-icon>
                Informaci√≥n B√°sica
              </h3>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Nombre del Equipo</mat-label>
                  <input matInput formControlName="name" placeholder="Ej: Mancuernas 10kg">
                  <mat-icon matPrefix>label</mat-icon>
                  <mat-error *ngIf="equipmentForm.get('name')?.hasError('required')">
                    El nombre es requerido
                  </mat-error>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Categor√≠a</mat-label>
                  <mat-select formControlName="category" (selectionChange)="onCategoryChange()">
                    <mat-option *ngFor="let cat of categoryOptions" [value]="cat.value">
                      <mat-icon>{{ cat.icon }}</mat-icon>
                      {{ cat.label }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>category</mat-icon>
                </mat-form-field>
              </div>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Marca</mat-label>
                  <input matInput formControlName="brand" placeholder="Ej: Rogue, Life Fitness">
                  <mat-icon matPrefix>business</mat-icon>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Cantidad</mat-label>
                  <input matInput type="number" formControlName="quantity" min="1">
                  <mat-icon matPrefix>shopping_cart</mat-icon>
                </mat-form-field>
              </div>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Estado</mat-label>
                  <mat-select formControlName="status">
                    <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                      <span class="status-dot" [style.background-color]="status.color"></span>
                      {{ status.label }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>toggle_on</mat-icon>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Zona</mat-label>
                  <mat-select formControlName="zone" multiple>
                    <mat-option value="free-weights">Zona Peso Libre</mat-option>
                    <mat-option value="machines">√Årea M√°quinas</mat-option>
                    <mat-option value="functional">Espacio Funcional</mat-option>
                    <mat-option value="cardio">√Årea Cardio</mat-option>
                  </mat-select>
                  <mat-icon matPrefix>location_on</mat-icon>
                  <mat-error *ngIf="equipmentForm.get('zone')?.hasError('required')">
                    La zona es requerida
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
  
            <mat-divider></mat-divider>
  
            <!-- ESPECIFICACIONES T√âCNICAS -->
            <div class="form-section">
              <h3 class="section-title">
                <mat-icon>settings</mat-icon>
                Especificaciones T√©cnicas
              </h3>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Rango de Peso</mat-label>
                  <input matInput formControlName="weightRange" placeholder="Ej: 1-40kg">
                  <mat-icon matPrefix>fitness_center</mat-icon>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Peso M√°ximo (kg)</mat-label>
                  <input matInput type="number" formControlName="maxWeight">
                  <mat-icon matPrefix>monitor_weight</mat-icon>
                </mat-form-field>
              </div>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Dimensiones</mat-label>
                  <input matInput formControlName="dimensions" placeholder="Ej: 2m x 1m x 1.5m">
                  <mat-icon matPrefix>straighten</mat-icon>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>URL de Imagen</mat-label>
                  <input matInput formControlName="imageUrl" placeholder="https://...">
                  <mat-icon matPrefix>image</mat-icon>
                </mat-form-field>
              </div>
            </div>
  
            <mat-divider></mat-divider>
  
            <!-- INFORMACI√ìN ADICIONAL -->
            <div class="form-section">
              <h3 class="section-title">
                <mat-icon>event</mat-icon>
                Informaci√≥n Adicional
              </h3>
  
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Fecha de Compra</mat-label>
                  <input matInput [matDatepicker]="purchasePicker" formControlName="purchaseDate">
                  <mat-datepicker-toggle matSuffix [for]="purchasePicker"></mat-datepicker-toggle>
                  <mat-datepicker #purchasePicker></mat-datepicker>
                  <mat-icon matPrefix>calendar_today</mat-icon>
                </mat-form-field>
  
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Costo (USD)</mat-label>
                  <input matInput type="number" formControlName="cost" min="0" step="0.01">
                  <mat-icon matPrefix>attach_money</mat-icon>
                </mat-form-field>
              </div>
  
              <mat-form-field appearance="outline" class="form-field full-width">
                <mat-label>Notas / Observaciones</mat-label>
                <textarea matInput formControlName="notes" rows="3" 
                          placeholder="Informaci√≥n adicional sobre el equipo..."></textarea>
                <mat-icon matPrefix>notes</mat-icon>
              </mat-form-field>
            </div>
  
            <!-- ACCIONES DEL FORMULARIO -->
            <div class="form-actions">
              <button mat-stroked-button type="button" (click)="cancelForm()">
                <mat-icon>close</mat-icon>
                Cancelar
              </button>
  
              <button mat-raised-button type="submit" class="save-btn" 
                      [disabled]="equipmentForm.invalid">
                <mat-icon>save</mat-icon>
                {{ editingEquipment ? 'Actualizar' : 'Guardar' }} Equipo
              </button>
            </div>
  
          </form>
        </mat-card-content>
      </mat-card>
  
      <!-- FILTROS Y B√öSQUEDA -->
      <mat-card class="filters-card">
        <mat-card-content>
          <div class="filters-row">
            <!-- B√öSQUEDA -->
            <mat-form-field appearance="outline" class="filter-field search-field">
              <mat-label>Buscar equipo</mat-label>
              <input matInput 
                     [value]="searchTerm"
                     (input)="onSearchChange($any($event.target).value)"
                     placeholder="Nombre, marca...">
              <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>
  
            <!-- FILTRO CATEGOR√çA -->
            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>Categor√≠a</mat-label>
              <mat-select [value]="filterCategory" (selectionChange)="onCategoryFilterChange($event.value)">
                <mat-option value="all">Todas</mat-option>
                <mat-option *ngFor="let cat of categoryOptions" [value]="cat.value">
                  {{ cat.label }}
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>category</mat-icon>
            </mat-form-field>
  
            <!-- FILTRO ESTADO -->
            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>Estado</mat-label>
              <mat-select [value]="filterStatus" (selectionChange)="onStatusFilterChange($event.value)">
                <mat-option value="all">Todos</mat-option>
                <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                  {{ status.label }}
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>toggle_on</mat-icon>
            </mat-form-field>
  
            <!-- SELECTOR DE VISTA -->
            <div class="view-toggle">
              <button mat-icon-button 
                      [class.active]="selectedView === 'cards'"
                      (click)="toggleView('cards')"
                      matTooltip="Vista de tarjetas">
                <mat-icon>grid_view</mat-icon>
              </button>
              <button mat-icon-button 
                      [class.active]="selectedView === 'table'"
                      (click)="toggleView('table')"
                      matTooltip="Vista de tabla">
                <mat-icon>table_rows</mat-icon>
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
  
      <!-- VISTA DE TARJETAS -->
      <div class="equipment-grid" *ngIf="selectedView === 'cards'">
        <mat-card class="equipment-card" *ngFor="let equipment of filteredEquipment">
          <!-- Imagen o Placeholder -->
          <div class="equipment-image">
            <img *ngIf="equipment.imageUrl" [src]="equipment.imageUrl" [alt]="equipment.name">
            <div *ngIf="!equipment.imageUrl" class="image-placeholder">
              <mat-icon>{{ getCategoryIcon(equipment.category) }}</mat-icon>
            </div>
            
            <!-- Badge de Mantenimiento -->
            <div class="maintenance-badge" *ngIf="needsMaintenance(equipment)">
              <mat-icon>warning</mat-icon>
              <span>Requiere Mantenimiento</span>
            </div>
          </div>
  
          <mat-card-header>
            <mat-card-title>
              {{ equipment.name }}
              <mat-chip [style.background-color]="getStatusColor(equipment.status)" class="status-chip">
                {{ equipment.status }}
              </mat-chip>
            </mat-card-title>
            <mat-card-subtitle>
              <mat-icon>{{ getCategoryIcon(equipment.category) }}</mat-icon>
              {{ equipment.category | titlecase }}
              <span *ngIf="equipment.brand"> ‚Ä¢ {{ equipment.brand }}</span>
            </mat-card-subtitle>
          </mat-card-header>
  
          <mat-card-content>
            <div class="equipment-details">
              <div class="detail-item">
                <mat-icon>shopping_cart</mat-icon>
                <span><strong>Cantidad:</strong> {{ equipment.quantity }}</span>
              </div>
  
              <div class="detail-item">
                <mat-icon>location_on</mat-icon>
                <span><strong>Zona:</strong> {{ equipment.zone | titlecase }}</span>
              </div>
  
              <div class="detail-item" *ngIf="equipment.specifications?.weightRange">
                <mat-icon>fitness_center</mat-icon>
                <span><strong>Peso:</strong> {{ equipment.specifications?.weightRange }}</span>
              </div>
  
              <div class="detail-item" *ngIf="equipment.lastMaintenance">
                <mat-icon>build</mat-icon>
                <span><strong>√ölt. Mantenimiento:</strong> {{ formatDate(equipment.lastMaintenance) }}</span>
              </div>
  
              <div class="detail-item" *ngIf="equipment.nextMaintenanceDate">
                <mat-icon>event</mat-icon>
                <span><strong>Pr√≥x. Mantenimiento:</strong> {{ formatDate(equipment.nextMaintenanceDate) }}</span>
              </div>
  
              <div class="detail-item" *ngIf="equipment.notes">
                <mat-icon>notes</mat-icon>
                <span>{{ equipment.notes }}</span>
              </div>
            </div>
  
            <!-- Estad√≠sticas de Uso -->
            <div class="usage-stats" *ngIf="equipment.usageStats">
              <div class="stat-item">
                <span class="stat-label">Total Usos</span>
                <span class="stat-value">{{ equipment.usageStats.totalUses }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Promedio/D√≠a</span>
                <span class="stat-value">{{ equipment.usageStats.averageUsesPerDay.toFixed(1) }}</span>
              </div>
            </div>
          </mat-card-content>
  
          <mat-card-actions>
            <button mat-button (click)="editEquipment(equipment)">
              <mat-icon>edit</mat-icon>
              Editar
            </button>
  
            <button mat-button (click)="markForMaintenance(equipment)" 
                    *ngIf="equipment.status === 'operational'">
              <mat-icon>build</mat-icon>
              Mantenimiento
            </button>
  
            <button mat-button (click)="completeMaintenanceAndMarkOperational(equipment)" 
                    *ngIf="equipment.status === 'maintenance'">
              <mat-icon>check_circle</mat-icon>
              Completado
            </button>
  
            <button mat-button color="warn" (click)="deleteEquipment(equipment)">
              <mat-icon>delete</mat-icon>
              Eliminar
            </button>
          </mat-card-actions>
        </mat-card>
  
        <!-- MENSAJE CUANDO NO HAY RESULTADOS -->
        <div class="no-results" *ngIf="filteredEquipment.length === 0">
          <mat-icon>search_off</mat-icon>
          <h3>No se encontraron equipos</h3>
          <p>Intenta ajustar los filtros o agrega un nuevo equipo</p>
          <button mat-raised-button (click)="showAddForm = true">
            <mat-icon>add</mat-icon>
            Agregar Equipo
          </button>
        </div>
      </div>
  
      <!-- VISTA DE TABLA -->
      <mat-card class="table-card" *ngIf="selectedView === 'table'">
        <mat-card-content>
          <table mat-table [dataSource]="dataSource" matSort class="equipment-table">
  
            <!-- Columna Nombre -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
              <td mat-cell *matCellDef="let equipment">
                <div class="table-name">
                  <mat-icon>{{ getCategoryIcon(equipment.category) }}</mat-icon>
                  <span>{{ equipment.name }}</span>
                </div>
              </td>
            </ng-container>
  
            <!-- Columna Categor√≠a -->
            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Categor√≠a</th>
              <td mat-cell *matCellDef="let equipment">
                <mat-chip class="category-chip">
                  {{ equipment.category | titlecase }}
                </mat-chip>
              </td>
            </ng-container>
  
            <!-- Columna Cantidad -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Cantidad</th>
              <td mat-cell *matCellDef="let equipment">
                <strong>{{ equipment.quantity }}</strong>
              </td>
            </ng-container>
  
            <!-- Columna Estado -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
              <td mat-cell *matCellDef="let equipment">
                <mat-chip [style.background-color]="getStatusColor(equipment.status)" class="status-chip">
                  {{ equipment.status | titlecase }}
                </mat-chip>
                <mat-icon *ngIf="needsMaintenance(equipment)" 
                          class="warning-icon"
                          matTooltip="Requiere mantenimiento">
                  warning
                </mat-icon>
              </td>
            </ng-container>
  
            <!-- Columna Zona -->
            <ng-container matColumnDef="zone">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Zona</th>
              <td mat-cell *matCellDef="let equipment">
                {{ equipment.zone | titlecase }}
              </td>
            </ng-container>
  
            <!-- Columna √öltimo Mantenimiento -->
            <ng-container matColumnDef="lastMaintenance">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>√öltimo Mantenimiento</th>
              <td mat-cell *matCellDef="let equipment">
                {{ formatDate(equipment.lastMaintenance) }}
              </td>
            </ng-container>
  
            <!-- Columna Acciones -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let equipment">
                <button mat-icon-button [matMenuTriggerFor]="menu" class="action-menu-btn">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="editEquipment(equipment)">
                    <mat-icon>edit</mat-icon>
                    <span>Editar</span>
                  </button>
                  <button mat-menu-item (click)="markForMaintenance(equipment)" 
                          *ngIf="equipment.status === 'operational'">
                    <mat-icon>build</mat-icon>
                    <span>Marcar Mantenimiento</span>
                  </button>
                  <button mat-menu-item (click)="completeMaintenanceAndMarkOperational(equipment)" 
                          *ngIf="equipment.status === 'maintenance'">
                    <mat-icon>check_circle</mat-icon>
                    <span>Completar Mantenimiento</span>
                  </button>
                  <mat-divider></mat-divider>
                  <button mat-menu-item (click)="deleteEquipment(equipment)" class="danger-action">
                    <mat-icon>delete</mat-icon>
                    <span>Eliminar</span>
                  </button>
                </mat-menu>
              </td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  
            <!-- Mensaje cuando no hay datos -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" [attr.colspan]="displayedColumns.length">
                <div class="no-data-message">
                  <mat-icon>search_off</mat-icon>
                  <p>No se encontraron equipos con los filtros aplicados</p>
                </div>
              </td>
            </tr>
  
          </table>
  
          <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" 
                         showFirstLastButtons
                         class="premium-paginator">
          </mat-paginator>
        </mat-card-content>
      </mat-card>
  
    </div>
  </div>