<!-- IMPORTANTE: Carlos, reemplaza COMPLETAMENTE tu routine-validation.component.html con este c√≥digo -->
<!-- ü§ñ VALIDACI√ìN RUTINAS IA PREMIUM - NIVEL FINZENAPP EXACTO -->
<style>
  .routine-details-modal mat-card-title {
    color: #ffffff !important;
  }
  .routine-details-modal .mat-mdc-card-title {
    color: #ffffff !important;
  }
  </style>
<div class="routine-validation-container">

  <!-- =============================================================================== -->
  <!-- üîô NAVEGACI√ìN ATR√ÅS - PREMIUM -->
  <!-- =============================================================================== -->
  <div class="back-navigation">
    <button class="back-button" routerLink="/dashboard/overview">
      <mat-icon>arrow_back</mat-icon>
      <span>Volver al Dashboard</span>
    </button>
  </div>

  <!-- =============================================================================== -->
  <!-- üèÜ HEADER CON M√âTRICAS - PREMIUM FINZENAPP -->
  <!-- =============================================================================== -->
  <div class="validation-header">
    <div class="header-content">
      <div>
        <h1>
          <mat-icon>fitness_center</mat-icon>
          Validaci√≥n de Rutinas IA
        </h1>
        <p class="subtitle">Dashboard para revisar y aprobar rutinas generadas por inteligencia artificial</p>
      </div>
    </div>

    <!-- üéØ M√âTRICAS CARDS - ESTILO FINZENAPP -->
    <div class="metrics-cards" *ngIf="metrics">
      <mat-card class="metric-card pending">
        <mat-card-content>
          <div class="metric-content">
            <mat-icon class="pending-icon">schedule</mat-icon>
            <div class="metric-text">
              <div class="metric-value">{{ metrics.totalPending || 0 }}</div>
              <div class="metric-label">Pendientes</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card approved">
        <mat-card-content>
          <div class="metric-content">
            <mat-icon class="approved-icon">check_circle</mat-icon>
            <div class="metric-text">
              <div class="metric-value">{{ metrics.totalApproved || 0 }}</div>
              <div class="metric-label">Aprobadas</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card rejected">
        <mat-card-content>
          <div class="metric-content">
            <mat-icon class="rejected-icon">cancel</mat-icon>
            <div class="metric-text">
              <div class="metric-value">{{ metrics.totalRejected || 0 }}</div>
              <div class="metric-label">Rechazadas</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card time">
        <mat-card-content>
          <div class="metric-content">
            <mat-icon class="time-icon">timer</mat-icon>
            <div class="metric-text">
              <div class="metric-value">{{ getAverageTimeFormatted() }}</div>
              <div class="metric-label">Tiempo Promedio</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- =============================================================================== -->
  <!-- üéõÔ∏è BARRA DE ACCIONES - PREMIUM -->
  <!-- =============================================================================== -->
  <mat-card class="actions-bar">
    <mat-card-content>
      <div class="controls-section">
        <!-- Filtros r√°pidos -->
        <div class="left-actions">
          <button mat-raised-button 
                  [class.active]="filterForm.get('status')?.value === 'pending_approval'"
                  (click)="showPendingOnly()"
                  matTooltip="Solo rutinas pendientes">
            <mat-icon>schedule</mat-icon>
            <span>Pendientes</span>
            <mat-badge [matBadge]="metrics?.totalPending || 0" matBadgeColor="warn" 
                       *ngIf="(metrics?.totalPending || 0) > 0"></mat-badge>
          </button>

          <button mat-raised-button 
                  [class.active]="filterForm.get('status')?.value === 'approved'"
                  (click)="showApprovedOnly()"
                  matTooltip="Solo rutinas aprobadas">
            <mat-icon>check_circle</mat-icon>
            <span>Aprobadas</span>
          </button>

          <button mat-raised-button 
                  [class.active]="filterForm.get('status')?.value === 'rejected'"
                  (click)="showRejectedOnly()"
                  matTooltip="Solo rutinas rechazadas">
            <mat-icon>cancel</mat-icon>
            <span>Rechazadas</span>
          </button>

          <button mat-raised-button 
                  [class.active]="filterForm.get('status')?.value === 'all'"
                  (click)="showAllRoutines()"
                  matTooltip="Todas las rutinas">
            <mat-icon>list</mat-icon>
            <span>Todas</span>
          </button>
        </div>

        <!-- B√∫squeda y acciones -->
        <div class="search-actions">
          <form [formGroup]="filterForm">
            <div class="search-field">
              <mat-form-field appearance="outline" subscriptSizing="dynamic">
                <mat-label>Buscar rutinas...</mat-label>
                <input matInput 
                       formControlName="searchTerm"
                       placeholder="Buscar por nombre, usuario o ejercicios"
                       (keyup.enter)="applyFilters()">
                <mat-icon matPrefix>search</mat-icon>
                <button mat-icon-button matSuffix 
                        *ngIf="filterForm.get('searchTerm')?.value"
                        (click)="clearSearch()"
                        matTooltip="Limpiar b√∫squeda">
                  <mat-icon>clear</mat-icon>
                </button>
              </mat-form-field>
            </div>
          </form>

          <div class="action-buttons">
            <button mat-raised-button (click)="toggleFilters()" matTooltip="Filtros avanzados">
              <mat-icon>filter_list</mat-icon>
              <span>Filtros</span>
            </button>

            <button mat-raised-button (click)="refreshData()" matTooltip="Refrescar datos">
              <mat-icon>refresh</mat-icon>
              <span>Refrescar</span>
            </button>

            <button mat-raised-button (click)="exportRoutines()" matTooltip="Exportar rutinas">
              <mat-icon>download</mat-icon>
              <span>Exportar</span>
            </button>
          </div>
        </div>

        <!-- Filtros avanzados -->
        <div class="advanced-filters" *ngIf="showFilters" [@slideDown]>
          <form [formGroup]="filterForm">
            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Dificultad</mat-label>
              <mat-select formControlName="difficulty" (selectionChange)="applyFilters()">
                <mat-option value="all">Todas las dificultades</mat-option>
                <mat-option value="beginner">Principiante</mat-option>
                <mat-option value="intermediate">Intermedio</mat-option>
                <mat-option value="advanced">Avanzado</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Nivel de Adaptaci√≥n</mat-label>
              <mat-select formControlName="adaptationLevel" (selectionChange)="applyFilters()">
                <mat-option value="all">Todos los niveles</mat-option>
                <mat-option value="low">Bajo</mat-option>
                <mat-option value="medium">Medio</mat-option>
                <mat-option value="high">Alto</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Fecha desde</mat-label>
              <input matInput [matDatepicker]="startPicker" 
                     formControlName="dateStart"
                     (dateChange)="applyFilters()">
              <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Fecha hasta</mat-label>
              <input matInput [matDatepicker]="endPicker" 
                     formControlName="dateEnd"
                     (dateChange)="applyFilters()">
              <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>

            <button mat-raised-button (click)="clearFilters()" matTooltip="Limpiar todos los filtros">
              <mat-icon>clear_all</mat-icon>
              <span>Limpiar</span>
            </button>
          </form>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- =============================================================================== -->
  <!-- üìã TABLA DE RUTINAS - PREMIUM FINZENAPP -->
  <!-- =============================================================================== -->
  
  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner">
      <mat-spinner diameter="60"></mat-spinner>
    </div>
    <div class="loading-text">
      Cargando rutinas de IA...
    </div>
  </div>

  <!-- Tabla principal -->
  <mat-card class="table-card" *ngIf="!loading">
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="routine-table">

        <!-- Columna: Usuario -->
        <ng-container matColumnDef="userInfo">
          <th mat-header-cell *matHeaderCellDef>Usuario</th>
          <td mat-cell *matCellDef="let routine" class="user-info-cell">
            <div class="user-info">
              <div class="user-avatar">
                {{ getUserInitials(getUserEmail(routine)) }}
              </div>
              <div class="user-details">
                <div class="user-name">{{ getUserDisplayName(routine) }}</div>
                <div class="user-email">{{ getUserEmail(routine) }}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Nombre de rutina -->
        <ng-container matColumnDef="routineName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Rutina</th>
          <td mat-cell *matCellDef="let routine" class="routine-name-cell">
            <div class="routine-info">
              <div class="routine-name">{{ getRoutineName(routine) }}</div>
              <div class="routine-subtitle">{{ getRoutineDescription(routine) }}</div>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Dificultad -->
        <ng-container matColumnDef="difficulty">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Dificultad</th>
          <td mat-cell *matCellDef="let routine" class="difficulty-cell">
            <div class="difficulty-chip" 
                 [ngClass]="getDifficultyClass(getRoutineDifficulty(routine))">
              {{ getDifficultyLabel(getRoutineDifficulty(routine)) }}
            </div>
          </td>
        </ng-container>

        <!-- Columna: Duraci√≥n -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Duraci√≥n</th>
          <td mat-cell *matCellDef="let routine" class="duration-cell">
            <div class="duration-info">
              <mat-icon>schedule</mat-icon>
              <span class="duration-text">{{ getRoutineDuration(routine) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Ejercicios -->
        <ng-container matColumnDef="exercises">
          <th mat-header-cell *matHeaderCellDef>Ejercicios</th>
          <td mat-cell *matCellDef="let routine" class="exercises-cell">
            <div class="exercises-info">
              <div class="exercises-count">{{ getExercisesCount(getRoutineExercises(routine)) }} ejercicios</div>
              <div class="exercises-types">{{ getExerciseTypes(getRoutineExercises(routine)) }}</div>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Confianza IA -->
        <ng-container matColumnDef="aiConfidence">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Confianza IA</th>
          <td mat-cell *matCellDef="let routine" class="ai-confidence-cell">
            <div class="confidence-info">
              <div class="confidence-percentage">{{ getConfidencePercentage(routine.aiConfidence || 0) }}%</div>
              <div class="confidence-bar">
                <div class="confidence-fill" 
                     [ngClass]="getConfidenceClass(routine.aiConfidence || 0)"
                     [style.width.%]="getConfidencePercentage(routine.aiConfidence || 0)">
                </div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Nivel de Adaptaci√≥n -->
        <ng-container matColumnDef="adaptationLevel">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Adaptaci√≥n</th>
          <td mat-cell *matCellDef="let routine" class="adaptation-cell">
            <div class="adaptation-chip" 
                 [ngClass]="getAdaptationClass(routine.adaptationLevel || 'medium')">
              {{ getAdaptationLabel(routine.adaptationLevel || 'medium') }}
            </div>
          </td>
        </ng-container>

        <!-- Columna: Fecha generada -->
        <ng-container matColumnDef="generatedAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Generada</th>
          <td mat-cell *matCellDef="let routine" class="date-cell">
            <div class="date-info">
              <div class="date-text">{{ getDateText(routine.generatedAt) }}</div>
              <div class="time-text">{{ getTimeText(routine.generatedAt) }}</div>
            </div>
          </td>
        </ng-container>

        <!-- Columna: Estado -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
          <td mat-cell *matCellDef="let routine" class="status-cell">
            <div class="status-chip" 
                 [ngClass]="getStatusClass(routine.status)">
              {{ getStatusLabel(routine.status) }}
            </div>
          </td>
        </ng-container>

        <!-- Columna: Acciones -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let routine" class="actions-cell">
            <div class="action-buttons">
              <!-- Botones para rutinas pendientes -->
              <ng-container *ngIf="routine.status === 'pending_approval'">
                <button mat-mini-fab 
                        class="approve-button"
                        (click)="approveRoutine(routine); $event.stopPropagation()"
                        matTooltip="Aprobar rutina">
                  <mat-icon>check</mat-icon>
                </button>

                <button mat-mini-fab 
                        class="reject-button"
                        (click)="rejectRoutine(routine); $event.stopPropagation()"
                        matTooltip="Rechazar rutina">
                  <mat-icon>close</mat-icon>
                </button>
              </ng-container>

              <!-- Bot√≥n eliminar (siempre visible) -->
              <button mat-mini-fab
                      class="delete-button"
                      (click)="deleteRoutine(routine); $event.stopPropagation()"
                      matTooltip="Eliminar rutina">
                <mat-icon>delete</mat-icon>
              </button>

              <!-- Bot√≥n ver detalles (siempre visible) -->
              <button mat-raised-button
                      class="view-details-button"
                      (click)="viewRoutineDetails(routine); $event.stopPropagation()"
                      matTooltip="Ver detalles completos">
                <mat-icon>visibility</mat-icon>
                <span>Detalles</span>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Header y filas -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
            [class.selected]="selectedRoutine?.id === row.id"
            (click)="viewRoutineDetails(row)"></tr>
      </table>

      <!-- Estado vac√≠o -->
      <div class="empty-state" *ngIf="dataSource.data.length === 0">
        <div class="empty-icon">
          <mat-icon>fitness_center</mat-icon>
        </div>
        <h3>No hay rutinas para mostrar</h3>
        <p>No se encontraron rutinas que coincidan con los filtros aplicados. Prueba ajustando los criterios de b√∫squeda.</p>
        <button mat-raised-button (click)="clearFilters()">
          <mat-icon>refresh</mat-icon>
          Limpiar filtros
        </button>
      </div>

      <!-- Paginador -->
      <mat-paginator #paginator
                     [pageSizeOptions]="[10, 25, 50, 100]"
                     [pageSize]="25"
                     showFirstLastButtons
                     aria-label="Seleccionar p√°gina de rutinas">
      </mat-paginator>
    </div>
  </mat-card>

  <!-- =============================================================================== -->
  <!-- üîç PREVIEW DE RUTINA SELECCIONADA (Opcional - para expandir en el futuro) -->
  <!-- =============================================================================== -->
  <mat-card class="routine-preview" *ngIf="selectedRoutine && showPreview">
    <div class="preview-header">
      <div class="routine-icon">
        <mat-icon>fitness_center</mat-icon>
      </div>
      <div class="routine-title">{{ getRoutineName(selectedRoutine) }}</div>
    </div>
    
    <div class="exercise-list" *ngIf="getRoutineExercises(selectedRoutine) && getRoutineExercises(selectedRoutine).length > 0">
      <div class="exercise-item" *ngFor="let exercise of getRoutineExercises(selectedRoutine).slice(0, 5)">
        <mat-icon class="exercise-icon">{{ getExerciseIcon(exercise.type) }}</mat-icon>
        <div class="exercise-name">{{ exercise.name }}</div>
        <div class="exercise-details">{{ exercise.sets }} x {{ exercise.reps || exercise.duration }}</div>
      </div>
      
      <div class="exercise-item" *ngIf="getRoutineExercises(selectedRoutine).length > 5">
        <mat-icon class="exercise-icon">more_horiz</mat-icon>
        <div class="exercise-name">Y {{ getRoutineExercises(selectedRoutine).length - 5 }} ejercicios m√°s...</div>
        <div class="exercise-details">Ver detalles completos</div>
      </div>
    </div>
  </mat-card>

</div>