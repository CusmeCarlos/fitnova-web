<!-- src/app/analytics/overview/overview.component.html -->
<!-- üìä ANALYTICS DASHBOARD ULTRA PREMIUM - NIVEL FINZENAPP EXACTO -->

<div class="analytics-dashboard-container">
  
    <!-- ‚úÖ HEADER ULTRA PREMIUM CON GLASSMORPHISM -->
    <div class="premium-header">
      <div class="header-content">
        <div class="header-left">
          <button mat-icon-button class="back-btn-premium" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
          </button>
          
          <div class="header-info">
            <h1 class="premium-title">
              <mat-icon class="title-icon">analytics</mat-icon>
              Dashboard Ejecutivo
            </h1>
            <p class="premium-subtitle">M√©tricas globales y an√°lisis de efectividad del sistema</p>
          </div>
        </div>
        
        <div class="header-actions">
          <button mat-stroked-button class="action-btn-premium" (click)="refreshAnalytics()">
            <mat-icon>refresh</mat-icon>
            <span>Actualizar</span>
          </button>
          
          <button mat-stroked-button class="action-btn-premium" (click)="exportAnalytics()">
            <mat-icon>file_download</mat-icon>
            <span>Exportar</span>
          </button>
        </div>
      </div>
    </div>
  
    <!-- ‚úÖ LOADING STATE PREMIUM -->
    <div class="loading-state-premium" *ngIf="isLoading">
      <div class="loading-content">
        <div class="loading-spinner">
          <mat-spinner diameter="60"></mat-spinner>
        </div>
        <h3>Cargando analytics ejecutivos...</h3>
        <p>Analizando m√©tricas globales del sistema</p>
      </div>
    </div>
  
    <!-- ‚úÖ CONTENIDO PRINCIPAL PREMIUM -->
    <div class="dashboard-content-premium" *ngIf="!isLoading">
      
      <!-- üìä M√âTRICAS EJECUTIVAS ULTRA PREMIUM -->
      <div class="metrics-grid-premium" *ngIf="analyticsMetrics">
        
        <!-- M√©trica 1: Usuarios Activos -->
        <div class="metric-card-premium users-metric">
          <div class="metric-header">
            <div class="metric-icon-container">
              <mat-icon class="metric-icon">people</mat-icon>
            </div>
            <div class="metric-badge">{{ totalUsers }}</div>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ totalUsers }}</h3>
            <p class="metric-label">Total Usuarios</p>
            <div class="metric-trend positive">
              <mat-icon>trending_up</mat-icon>
              <span>{{ activeUsersToday }} activos hoy</span>
            </div>
          </div>
        </div>
  
        <!-- M√©trica 2: Errores Reducidos -->
        <div class="metric-card-premium effectiveness-metric">
          <div class="metric-header">
            <div class="metric-icon-container">
              <mat-icon class="metric-icon">trending_down</mat-icon>
            </div>
            <div class="metric-badge">{{ getTotalErrorsReduced() }}</div>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ getTotalErrorsReduced() }}</h3>
            <p class="metric-label">Errores Reducidos</p>
            <div class="metric-trend positive">
              <mat-icon>check_circle</mat-icon>
              <span>Esta semana</span>
            </div>
          </div>
        </div>
  
        <!-- M√©trica 3: Ejercicios Mejorados -->
        <div class="metric-card-premium engagement-metric">
          <div class="metric-header">
            <div class="metric-icon-container">
              <mat-icon class="metric-icon">fitness_center</mat-icon>
            </div>
            <div class="metric-badge">{{ getTotalExercisesImproved() }}</div>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ getTotalExercisesImproved() }}</h3>
            <p class="metric-label">Ejercicios Mejorados</p>
            <div class="metric-trend positive">
              <mat-icon>trending_up</mat-icon>
              <span>Esta semana</span>
            </div>
          </div>
        </div>
  
        <!-- M√©trica 4: Promedio de Mejora -->
        <div class="metric-card-premium retention-metric">
          <div class="metric-header">
            <div class="metric-icon-container">
              <mat-icon class="metric-icon">show_chart</mat-icon>
            </div>
            <div class="metric-badge">{{ formatNumber(getAverageErrorReduction()) }}</div>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ formatNumber(getAverageErrorReduction()) }}</h3>
            <p class="metric-label">Promedio Mejora/Usuario</p>
            <div class="metric-trend positive">
              <mat-icon>person</mat-icon>
              <span>Errores reducidos por usuario</span>
            </div>
          </div>
        </div>
  
      </div>
  
      <!-- ‚úÖ GR√ÅFICOS INTERACTIVOS PREMIUM -->
      <div class="charts-grid-premium" *ngIf="analyticsMetrics">
        
        <!-- Gr√°fico 1: M√©tricas Globales de Uso -->
        <div class="chart-card-premium usage-chart">
          <div class="chart-header">
            <h4>
              <mat-icon>trending_up</mat-icon>
              M√©tricas Globales de Uso
            </h4>
            <button mat-icon-button class="chart-refresh-btn" (click)="refreshAnalytics()">
              <mat-icon>refresh</mat-icon>
            </button>
          </div>
          <div class="chart-container">
            <canvas #usageChart></canvas>
          </div>
        </div>
  
        <!-- Gr√°fico 2: Top Usuarios con Mejores Resultados -->
        <div class="chart-card-premium top-users-chart">
          <div class="chart-header">
            <h4>
              <mat-icon>emoji_events</mat-icon>
              Top Usuarios - Mejores Resultados
            </h4>
            <div class="accuracy-badge">
              {{ getTopUsers().length }} usuarios
            </div>
          </div>
          <div class="top-users-list">
            <div class="top-user-item" *ngFor="let user of getTopUsers(); let i = index">
              <div class="user-rank" [class]="'rank-' + (i + 1)">
                <mat-icon *ngIf="i === 0">emoji_events</mat-icon>
                <mat-icon *ngIf="i === 1">emoji_events</mat-icon>
                <mat-icon *ngIf="i === 2">emoji_events</mat-icon>
                <span *ngIf="i > 2">{{ i + 1 }}</span>
              </div>
              <div class="user-info">
                <div class="user-name">{{ user.displayName }}</div>
                <div class="user-stats">
                  <span class="stat-item">
                    <mat-icon>fitness_center</mat-icon>
                    {{ user.totalWorkouts }} entrenamientos
                  </span>
                  <span class="stat-item error-reduction">
                    <mat-icon>trending_down</mat-icon>
                    {{ user.errorsReduced }} errores menos
                  </span>
                </div>
              </div>
            </div>

            <div class="empty-message" *ngIf="getTopUsers().length === 0">
              <mat-icon>info</mat-icon>
              <p>No hay datos de usuarios disponibles</p>
            </div>
          </div>
        </div>
  
        <!-- Gr√°fico 3: Tendencia de Reducci√≥n de Errores -->
        <div class="chart-card-premium engagement-chart">
          <div class="chart-header">
            <h4>
              <mat-icon>trending_down</mat-icon>
              Tendencia Semanal - Reducci√≥n de Errores
            </h4>
            <div class="engagement-badge">
              √öltimas semanas
            </div>
          </div>
          <div class="chart-container">
            <canvas #errorTrendChart></canvas>
          </div>
        </div>
  
      </div>
  
      <!-- ‚úÖ EMPTY STATE PREMIUM -->
      <div class="empty-state-premium" *ngIf="!analyticsMetrics && !isLoading">
        <div class="empty-content">
          <mat-icon class="empty-icon">analytics</mat-icon>
          <h3>Sin datos de analytics</h3>
          <p>No hay suficientes datos para generar m√©tricas ejecutivas.</p>
          <button mat-raised-button color="primary" (click)="refreshAnalytics()">
            <mat-icon>refresh</mat-icon>
            Intentar de nuevo
          </button>
        </div>
      </div>
  
    </div>
  
  </div>